<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/3926bf6b30.js" crossorigin="anonymous"></script>
    <title>User Information</title>
    <style>
        body {
            background: #212121;
            align-items: center;
            text-align: center;
            color: white;
        }

        #result {
            margin-top: 20px;
        }

        #error {
            color: red;
            margin-top: 10px;
        }

        .searchBox {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, 50%);
            background: #e8f0fe;
            height: 40px;
            border-radius: 40px;
            padding: 10px;
            overflow: hidden; /* Added overflow: hidden to prevent color change overflow */
        }

        .searchBox:hover > .searchInput {
            width: 240px;
            padding: 0 6px;
        }

        .searchBox:hover > .searchButton {
            background: black;
            color: #ffffff;
        }

        .searchButton {
            color: black;
            float: right;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e8f0fe;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.4s;
        }

        .searchInput {
            border: none;
            background: none;
            outline: none;
            float: left;
            padding: 0;
            color: white;
            font-size: 16px;
            transition: 0.4s;
            line-height: 40px;
            width: 0px;
        }

        @media screen and (max-width: 620px) {
            .searchBox:hover > .searchInput {
                width: 150px;
                padding: 0 6px;
            }
        }

        #spinner {
            display: none;
        }

        #taskFields {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div style="margin-top: 15%;">
    <h1>User Information</h1>
    <a href="users/register.html" style="color: aqua; text-decoration: none; margin-bottom: 9%;">Register Now!</a>
    <label for="username">Enter your username:</label>
    <div class="searchBox">
        <input class="searchInput" type="text" name="" placeholder="USERNAME" id="username">
        <button class="searchButton" href="#" onclick="getUserInfo()">
            <i class="fas fa-search"></i>
        </button>
    </div>

    <div id="spinner">Loading...</div>
    <div id="result" style="margin-top: 8%;"></div>
    <div id="error" style="margin-top: 8%;"></div>

    <!-- Task fields (initially hidden) -->
    <div id="taskFields">
        <label for="task1">Task 1:</label>
        <input type="text" id="task1" name="task1" readonly>
        <!-- Repeat for task2 to task6 -->
    </div>
</div>

<script>
    function getUserInfo() {
        var getUsername = document.getElementById('username').value;
        var spinner = document.getElementById('spinner');
        var taskFields = document.getElementById('taskFields');

        spinner.style.display = 'block';

        var url = 'https://script.google.com/macros/s/AKfycbzZNQF3ms9WUbqXpD7DXYY74RS-E44igEZRqIHCIYr1JHh6SLUzHsEDh1L5AmTwLz5K/exec?username=' + encodeURIComponent(getUsername);

        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                spinner.style.display = 'none';
                if (xhr.status === 200) {
                    var result = JSON.parse(xhr.responseText);
                    displayResult(result);
                    if (result.userInfo) {
                        displayTaskFields(result.userInfo);
                    }
                } else {
                    displayError('Error: Unable to fetch data.');
                }
            }
        };

        xhr.open('GET', url, true);
        xhr.send();
    }

    function displayTaskFields(userInfo) {
        var taskFields = document.getElementById('taskFields');
        taskFields.style.display = 'block';

        document.getElementById('task1').value = userInfo.task1 || 'not completed';
        // Repeat for task2 to task6
    }

    function displayResult(result) {
        var resultDisplay = document.getElementById('result');
        var errorDisplay = document.getElementById('error');
        resultDisplay.innerHTML = '';
        errorDisplay.innerHTML = '';

        if (result.result === 'success') {
            if (result.row) {
                resultDisplay.innerHTML += '<p>New Row: ' + result.row + '</p>';
            }
            if (result.userInfo) {
                resultDisplay.innerHTML += '<p>User Info: ' + JSON.stringify(result.userInfo) + '</p>';
            }
        } else if (result.result === 'error') {
            displayError('Error: ' + result.error);
        }
    }

    function displayError(message) {
        var errorDisplay = document.getElementById('error');
        errorDisplay.innerHTML = '<p>' + message + '</p>';
    }
</script>

</body>
</html>
